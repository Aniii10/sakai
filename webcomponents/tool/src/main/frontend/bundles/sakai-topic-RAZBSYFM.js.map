{
  "version": 3,
  "sources": ["../node_modules/@sakai-ui/sakai-conversations/src/utils.js", "../node_modules/@sakai-ui/sakai-conversations/src/reactions-mixin.js", "../node_modules/@sakai-ui/sakai-conversations/src/SakaiCommentEditor.js", "../node_modules/@sakai-ui/sakai-conversations/sakai-comment-editor.js", "../node_modules/@sakai-ui/sakai-conversations/src/SakaiComment.js", "../node_modules/@sakai-ui/sakai-conversations/sakai-comment.js", "../node_modules/@sakai-ui/sakai-conversations/src/SakaiPost.js", "../node_modules/@sakai-ui/sakai-conversations/sakai-post.js", "../node_modules/@sakai-ui/sakai-conversations/src/SakaiTopic.js", "../node_modules/@sakai-ui/sakai-conversations/sakai-topic.js"],
  "sourcesContent": ["const flattenPosts = startPosts => {\n\n  const flattenAll = (posts = []) => {\n    return posts.flatMap(p => [ p, ...flattenPosts(p.posts) ]);\n  };\n\n  return flattenAll(startPosts);\n};\n\nexport const findPost = (topic, options = {}) => {\n\n  const flattened = flattenPosts(topic.continued && !options.postsInView ? topic.allPosts : topic.posts);\n\n  if (options.postId) {\n    return flattened.find(p => p.id === options.postId);\n  } else if (options.isInstructor) {\n    return flattened.filter(p => p.isInstructor === options.isInstructor).length;\n  }\n};\n\nexport const markThreadViewed = thread => {\n\n  thread.viewed = !thread.posts ? true : !flattenPosts(thread).filter(p => !p.viewed).length;\n  thread.expanded = !thread.viewed;\n};\n\nexport const debounce = (func, timeout = 300) => {\n\n  let timer;\n  return (...args) => {\n\n    clearTimeout(timer);\n    timer = setTimeout(() => { func.apply(this, args); }, timeout);\n  };\n};\n", "import { html } from \"lit\";\n\nexport const reactionsMixin = Base => class extends Base {\n\n  renderMyReactions(myReactions) {\n\n    const reactionIcons = {\n      \"LOVE_IT\": \"heart\",\n      \"GOOD_IDEA\": \"lightbulb\",\n      \"KEY\": \"key\",\n    };\n\n    return html`\n      ${Object.entries(myReactions).map(pair => html`\n        ${pair[0] !== \"GOOD_QUESTION\" && pair[0] !== \"GOOD_ANSWER\" && pair[0] !== \"GOOD_COMMENT\" ? html`\n        <li>\n          <button class=\"dropdown-item ${pair[1] ? \"reaction-on\" : undefined}\"\n              type=\"button\"\n              data-reaction=\"${pair[0]}\"\n              @click=${this.toggleReaction}\n              title=\"${this._i18n[pair[0]]}\"\n              aria-label=\"${this._i18n[pair[0]]}\">\n            <div>\n              <sakai-icon type=\"${reactionIcons[pair[0]]}\"\n                  size=\"small\"\n                  class=\"${reactionIcons[pair[0]]}\">\n              </sakai-icon>\n            </div>\n          </button>\n        </li>\n        ` : \"\"}\n      `)}\n    `;\n  }\n\n  renderReactionsBar(reactionTotals) {\n\n    const reactionIcons = {\n      \"LOVE_IT\": \"heart\",\n      \"GOOD_IDEA\": \"lightbulb\",\n      \"KEY\": \"key\",\n    };\n\n    return html`\n      <div class=\"topic-message-reactions-bar\" tabindex=\"0\">\n      ${Object.entries(reactionTotals).map(pair => html`\n        ${pair[0] !== \"GOOD_QUESTION\" && pair[0] !== \"GOOD_ANSWER\" && pair[0] !== \"GOOD_COMMENT\" && pair[1] > 0 ? html`\n        <div class=\"topic-reaction\">\n          <div>\n            <sakai-icon type=\"${reactionIcons[pair[0]]}\" size=\"small\" class=\"${reactionIcons[pair[0]]}\"></sakai-icon>\n          </div>\n          ${this.isInstructor ? html`\n          <div>\n          ${pair[1]}\n          </div>\n          ` : \"\"}\n        </div>\n        ` : \"\"}\n      `)}\n      </div>\n    `;\n  }\n\n  toggleReaction(e) {\n\n    e.stopPropagation();\n\n    const reaction = e.target.dataset.reaction;\n\n    this.myReactions[reaction] = !this.myReactions[reaction];\n    this._postReactions();\n  }\n};\n", "import { html } from \"lit\";\nimport { ifDefined } from \"lit/directives/if-defined.js\";\nimport { loadProperties } from \"@sakai-ui/sakai-i18n\";\nimport { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport \"@sakai-ui/sakai-editor\";\n\nexport class SakaiCommentEditor extends SakaiElement {\n\n  static properties = {\n\n    comment: { type: Object },\n    postId: { attribute: \"post-id\", type: String },\n    siteId: { attribute: \"site-id\", type: String },\n    topicId: { attribute: \"topic-id\", type: String },\n    _editing: { state: true },\n    _i18n: { state: true },\n  };\n\n  constructor() {\n\n    super();\n\n    loadProperties(\"conversations\").then(r => this._i18n = r);\n  }\n\n  set comment(value) {\n\n    this._comment = value;\n    this._editing = true;\n  }\n\n  get comment() { return this._comment; }\n\n  _commentOnPost() {\n\n    this.comment = this.comment || { message: \"\" };\n\n    const editor = this.querySelector(\"sakai-editor\");\n\n    this.comment.message = editor.getContent();\n\n    const isNew = !this.comment.id;\n\n    const postId = this.postId || this.comment.postId;\n\n    this.comment.postId = postId;\n    this.comment.topicId = this.topicId;\n\n    const url = `/api/sites/${this.siteId}/topics/${this.topicId}/posts/${postId}/comments${ this.comment.id ? `/${this.comment.id}` : \"\"}`;\n    fetch(url, {\n      method: this.comment.id ? \"PUT\" : \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      credentials: \"include\",\n      body: JSON.stringify(this.comment),\n    })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(\"Network error while saving comment.\");\n      }\n      return r.json();\n    })\n    .then(comment => {\n\n      this.dispatchEvent(new CustomEvent(isNew ? \"comment-created\" : \"comment-updated\", { detail: { comment }, bubbles: true }));\n      this._editing = false;\n      this.comment.message = \"\";\n    })\n    .catch (error => {\n      console.error(error);\n      //TODO: show error message to user here\n    });\n  }\n\n  _startEditing() {\n    this._editing = true;\n  }\n\n  _cancelEditing() {\n\n    this._editing = false;\n    this.dispatchEvent(new CustomEvent(\"editing-cancelled\", { bubbles: true }));\n  }\n\n  shouldUpdate() {\n    return this._i18n && this.postId;\n  }\n\n  render() {\n\n    return html`\n      <div>\n        ${this._editing ? html`\n        <sakai-editor content=${ifDefined(this.comment ? this.comment.message : undefined)} set-focus></sakai-editor>\n        <div class=\"act\">\n          <input type=\"button\" class=\"active\" @click=${this._commentOnPost} value=\"${this._i18n.publish}\">\n          <input type=\"button\" @click=${this._cancelEditing} value=\"${this._i18n.cancel}\">\n        </div>\n        ` : html`\n        <input class=\"comment-editor-input\"\n            aria-label=\"${this._i18n.comment_editor_placeholder}\"\n            value=\"${this._i18n.add_a_comment}\"\n            @click=${this._startEditing}\n            @keydown=${this._startEditing} />\n        `}\n      </div>\n    `;\n  }\n}\n", "import { SakaiCommentEditor } from './src/SakaiCommentEditor.js';\n\ncustomElements.define('sakai-comment-editor', SakaiCommentEditor);\n", "import { html, nothing } from \"lit\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport \"@sakai-ui/sakai-user-photo\";\nimport \"../sakai-comment-editor.js\";\n\nexport class SakaiComment extends SakaiElement {\n\n  static properties = {\n\n    comment: { type: Object },\n    topicId: { attribute: \"topic-id\", type: String },\n    siteId: { attribute: \"site-id\", type: String },\n    _editing: { attribute: false, type: Boolean },\n    _i18n: { attribute: false, type: Boolean },\n  };\n\n  constructor() {\n\n    super();\n\n    this.loadTranslations(\"conversations\").then(r => this._i18n = r);\n  }\n\n  _deleteComment() {\n\n    if (!confirm(this._i18n.confirm_comment_delete)) {\n      return;\n    }\n\n    const url = `/api/sites/${this.siteId}/topics/${this.topicId}/posts/${this.comment.postId}/comments/${this.comment.id}`;\n    fetch(url, {\n      method: \"DELETE\",\n      credentials: \"include\",\n    })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(\"Network error while deleting a comment.\");\n      } else {\n        this.dispatchEvent(new CustomEvent(\"comment-deleted\", { detail: { comment: this.comment }, bubbles: true } ));\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _commentUpdated(e) {\n\n    this.comment = e.detail.comment;\n    this._editing = false;\n  }\n\n  _startEditing() { this._editing = true; }\n\n  _stopEditing() { this._editing = false; }\n\n  updated() {\n\n    if (typeof MathJax !== \"undefined\") {\n      MathJax.Hub.Queue([ \"Typeset\", MathJax.Hub ]);\n    }\n  }\n\n  shouldUpdate() {\n    return this._i18n && this.comment;\n  }\n\n  _renderOptionsMenu() {\n\n    return html`\n      <div class=\"dropdown\">\n        <button class=\"btn btn-transparent\"\n            id=\"comment-options-${this.comment.id}\"\n            type=\"button\"\n            title=\"${this._i18n.comment_options_menu_tooltip}\"\n            data-bs-toggle=\"dropdown\"\n            aria-haspopup=\"true\"\n            aria-expanded=\"false\"\n            aria-label=\"${this._i18n.comment_options_menu_tooltip}\">\n          <sakai-icon type=\"menu\" size=\"small\"></sakai-icon>\n        </button>\n        <ul class=\"dropdown-menu conv-dropdown-menu\" aria-labelledby=\"comment-options-${this.comment.id}\">\n          ${this.comment.canEdit ? html`\n          <li>\n            <button class=\"btn btn-icon dropdown-item\"\n                type=\"button\"\n                title=\"${this._i18n.edit_this_comment}\"\n                @click=${this._startEditing}\n                aria-label=\"${this._i18n.edit_this_comment}\">\n              ${this._i18n.edit}\n            </button>\n          </li>\n          ` : \"\"}\n          ${this.comment.canDelete ? html`\n          <li>\n            <button class=\"dropdown-item\"\n                type=\"button\"\n                @click=${this._deleteComment}\n                title=\"${this._i18n.delete_this_comment}\"\n                aria-label=\"${this._i18n.delete_this_comment}\">\n              ${this._i18n.delete}\n            </button>\n          </li>\n          ` : nothing }\n        </ul>\n      </div>\n    `;\n  }\n\n  render() {\n\n    return html`\n      <div class=\"post-comment\">\n        <div class=\"post-comment-topbar\">\n          <div class=\"photo\">\n            <sakai-user-photo\n                user-id=\"${this.comment.creator}\"\n                classes=\"medium-thumbnail\"\n                profile-popup=\"on\">\n            </sakai-user-photo>\n          </div>\n          <div class=\"author-details\">\n            <div class=\"post-creator-name\">${this.comment.creatorDisplayName}</div>\n            <div class=\"post-created-date\">${this.comment.formattedCreatedDate}</div>\n          </div>\n          <div>\n          </div>\n\n          <div class=\"post-resolved-block\">\n          </div>\n        </div>\n        <div class=\"post-main\">\n          <div class=\"post-upvote-block\">\n          </div>\n            ${this._editing ? html`\n            <div class=\"post-edit-comment-block\">\n              <sakai-comment-editor\n                  post-id=\"${this.comment.postId}\"\n                  site-id=\"${this.siteId}\"\n                  topic-id=\"${this.topicId}\"\n                  comment=\"${JSON.stringify(this.comment)}\"\n                  @comment-updated=${this._commentUpdated}\n                  @editing-cancelled=${this._stopEditing}\n                  show-buttons>\n              </sakai-comment-editor>\n            </div>\n            <div></div>\n            ` : html`\n            <div class=\"post-message\">${unsafeHTML(this.comment.message)}</div>\n            <div class=\"post-reactions-block\">\n              ${!this.comment.locked && (this.comment.canEdit || this.comment.canDelete) ? html `\n              ${this._renderOptionsMenu()}\n              ` : \"\"}\n            </div>\n            `}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n", "import { SakaiComment } from './src/SakaiComment.js';\n\ncustomElements.define('sakai-comment', SakaiComment);\n", "import { html, nothing } from \"lit\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { ifDefined } from \"lit/directives/if-defined.js\";\nimport { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport { reactionsMixin } from \"./reactions-mixin.js\";\nimport { DISCUSSION, QUESTION } from \"./sakai-conversations-constants.js\";\nimport \"@sakai-ui/sakai-user-photo\";\nimport \"@sakai-ui/sakai-editor\";\nimport \"../sakai-comment.js\";\nimport \"../sakai-comment-editor.js\";\nimport \"@sakai-ui/sakai-icon\";\n\nexport class SakaiPost extends reactionsMixin(SakaiElement) {\n\n  static properties = {\n\n    post: { type: Object },\n    postType: { type: String },\n    isInstructor: { attribute: \"is-instructor\", type: Boolean },\n    canViewAnonymous: { attribute: \"can-view-anonymous\", type: Boolean },\n    canViewDeleted: { attribute: \"can-view-deleted\", type: Boolean },\n    siteId: { attribute: \"site-id\", type: String },\n\n    _showingComments: { state: true },\n    _expanded: { state: true },\n    _editing: { state: true },\n    _replying: { state: true },\n    _i18n: { state: true },\n  };\n\n  constructor() {\n\n    super();\n\n    this._showingComments = true;\n    this._expanded = true;\n\n    this.commentsBeingEdited = new Map();\n\n    this.loadTranslations(\"conversations\").then(r => this._i18n = r);\n  }\n\n  set post(value) {\n\n    this.myReactions = value.myReactions || {};\n\n    if (value.isThread && !value.keepExpanded) {\n      this._collapseIfAllViewed(value);\n    }\n\n    if (value.keepExpanded || value.continued) {\n      this._expanded = true;\n    }\n    const old = this._post;\n    this._post = value;\n\n    this.requestUpdate(\"post\", old);\n  }\n\n  get post() { return this._post; }\n\n  _collapseIfAllViewed(thread) {\n\n    const transformAll = (posts = []) => {\n      return posts.flatMap(r => [ r, ...transformAll(r.posts) ]);\n    };\n\n    const flattened = transformAll(thread.posts);\n\n    this._expanded = flattened.filter(p => !p.viewed).length > 0;\n  }\n\n  _postReactions() {\n\n    const url = this.post.links.find(l => l.rel === \"react\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(this.myReactions),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        return r.json();\n      }\n      throw new Error(\"Network error while posting reactions\");\n\n    })\n    .then(reactionTotals => {\n\n      this.post.myReactions = this.myReactions;\n      this.post.reactionTotals = reactionTotals;\n      this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n    })\n    .catch(error => console.error(error));\n  }\n\n  _toggleLocked() {\n\n    const url = this.post.links.find(l => l.rel === \"lock\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.post.locked),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        return r.json();\n      }\n\n      throw new Error(\"Network error while locking/unlocking post\");\n    })\n    .then(post => {\n      this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post }, bubbles: true }));\n    })\n    .catch(error => console.error(error));\n  }\n\n  _toggleHidden() {\n\n    const url = this.post.links.find(l => l.rel === \"hide\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.post.hidden),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        this.post.hidden = !this.post.hidden;\n        this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n      } else {\n        throw new Error(`Network error while hiding/showing post at ${url}: ${r.status}`);\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _replyToPostAsDraft() { this._replyToPost(true); }\n\n  _replyToPostAsPublished() { this._replyToPost(false); }\n\n  _replyToPost(draft = false) {\n\n    const reply = {\n      message: document.getElementById(`post-${this.post.id}-reply-editor`).getContent(),\n      parentPost: this.post.id,\n      // If the post being replied to is private, the reply must be private.\n      privatePost: this._privateReply || this.post.privatePost,\n      parentThread: this.post.parentThread || this.post.id,\n      draft,\n    };\n\n    const url = this.post.links.find(l => l.rel === \"reply\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(reply),\n    })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(\"Network error while replying to a post.\");\n      }\n      return r.json();\n    })\n    .then(post => {\n\n      if (!this.post.posts) this.post.posts = [];\n      this.post.posts.push(post);\n      this._replying = false;\n      this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post, created: true }, bubbles: true }));\n    })\n    .catch (error => console.error(error));\n  }\n\n  _savePostAsDraft() { this._savePost(true); }\n\n  _publishPost() { this._savePost(false); }\n\n  _savePost(draft) {\n\n    const currentMessage = this.post.message;\n\n    const editor = document.getElementById(`post-${this.post.id}-editor`);\n    this.post.message = editor.getContent();\n    this.post.draft = draft;\n\n    const url = this.post.links.find(l => l.rel === \"self\").href;\n    fetch(url, {\n      credentials: \"include\",\n      method: \"PUT\",\n      body: JSON.stringify(this.post),\n      headers: { \"Content-Type\": \"application/json\" },\n    })\n    .then(r => {\n\n      if (r.ok) {\n        return r.json();\n      }\n\n      throw new Error(`Network error while saving post: ${r.status}`);\n    })\n    .then(post => {\n\n      this.post = post;\n      this._editing = false;\n      this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n    })\n    .catch (error => {\n\n      console.error(error);\n      this.post.message = currentMessage;\n    });\n  }\n\n  _toggleUpvotePost() {\n\n    if (!this.post.canUpvote) return;\n\n    const url = `/api/sites/${this.siteId}/topics/${this.post.topic}/posts/${this.post.id}/${this.post.upvoted ? \"unupvote\" : \"upvote\"}`;\n    fetch(url, {\n      credentials: \"include\",\n    })\n    .then(r => {\n\n      if (r.ok) {\n        if (this.post.upvoted) {\n          this.post.upvotes -= 1;\n          this.post.upvoted = false;\n        } else {\n          this.post.upvotes += 1;\n          this.post.upvoted = true;\n        }\n        this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n        this.requestUpdate();\n      } else {\n        throw new Error(\"Network error while upvoting a post.\");\n      }\n    })\n    .catch (error => console.error(error));\n  }\n\n  _commentCreated(e) {\n\n    const comment = e.detail.comment;\n\n    this.post.comments = this.post.comments || [];\n    this.post.comments.unshift(comment);\n    this.post.numberOfComments = this.post.comments.length;\n    this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n    this._showingComments = true;\n  }\n\n  _commentUpdated(e) {\n\n    const comment = e.detail.comment;\n\n    this.post.comments.splice(this.post.comments.findIndex(c => c.id === comment.id), 1, comment);\n    this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n    this.commentsBeingEdited.set(comment.id, false);\n    this.requestUpdate();\n  }\n\n  _deletePost() {\n\n    if (!this.post.canDelete) return;\n\n    if (!confirm(this._i18n.confirm_post_delete)) {\n      return;\n    }\n\n    const url = this.post.links.find(l => l.rel === \"delete\").href;\n    fetch(url, {\n      method: \"DELETE\",\n      credentials: \"include\",\n    })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(\"Network error while deleting a post.\");\n      } else {\n        // The post has been hard deleted\n        if (this.post.depth > 5) {\n          // TODO: his is a hack and a lit-element anti-pattern. lit is somehow losing track of post\n          // elements that have been added to continued threads. Lit should be removing this in the\n          // render.\n          document.getElementById(`discussion-post-block-${this.post.id}`).remove();\n        }\n        this.dispatchEvent(new CustomEvent(\"post-deleted\", { detail: { post: this.post }, bubbles: true }));\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _commentDeleted(e) {\n\n    const commentId = e.detail.comment.id;\n    const index = this.post.comments.findIndex(c => c.id === commentId);\n    this.post.comments.splice(index, 1);\n    this.post.numberOfComments -= 1;\n    this.dispatchEvent(new CustomEvent(\"post-updated\", { detail: { post: this.post }, bubbles: true }));\n    this.requestUpdate();\n  }\n\n  _renderAuthorDetails() {\n\n    return html`\n\n      <div class=\"author-details\">\n        <div class=\"post-creator-name\">${this.post.creatorDisplayName}</div>\n        ${this.post.isInstructor ? html`\n        <div class=\"post-creator-instructor\">${this._i18n.instructor}</div>\n        ` : nothing }\n        <div class=\"post-created-date\">${this.post.formattedCreatedDate}</div>\n        ${this.post.draft ? html`\n        <div class=\"draft\">${this._i18n.draft}</div>\n        ` : nothing }\n        ${this.post.locked ? html`\n        <div class=\"topic-status\"\n            role=\"img\"\n            title=\"${this._i18n.post_locked_tooltip}\"\n            aria-label=\"${this._i18n.post_locked_tooltip}\">\n          <sakai-icon type=\"lock\" size=\"small\"></sakai-icon></div>\n        </div>\n        ` : nothing }\n        ${this.post.privatePost ? html`\n        <div class=\"topic-status\"\n            role=\"img\"\n            title=\"${this._i18n.post_private_tooltip}\"\n            aria-label=\"${this._i18n.post_private_tooltip}\">\n          <sakai-icon type=\"secret\" size=\"small\"></sakai-icon></div>\n        </div>\n        ` : nothing }\n      </div>\n    `;\n  }\n\n  _continueThreadFromHere() {\n    this.dispatchEvent(new CustomEvent(\"continue-thread\", { detail: { post: this.post }, bubbles: true }));\n  }\n\n  _getGoodAnswerTooltip() {\n\n    switch (this.post.type) {\n      case QUESTION:\n        return this.post.myReactions.GOOD_ANSWER ? \"ungoodanswer_tooltip\" : \"goodanswer_tooltip\";\n      case DISCUSSION:\n        return this.post.myReactions.GOOD_ANSWER ? \"ungoodpost_tooltip\" : \"goodpost_tooltip\";\n      default:\n        return \"\";\n    }\n  }\n\n  _setEditing() { this._editing = true; }\n\n  _unsetEditing() { this._editing = false; }\n\n  _setPrivatePost(e) { this.post.privatePost = e.target.checked; }\n\n  _setPrivateReply(e) { this._privateReply = e.target.checked; }\n\n  _unsetReplying() { this._replying = false; }\n\n  _toggleReplying() { this._replying = !this._replying; }\n\n  _toggleExpanded() { this._expanded = !this._expanded; }\n\n  _toggleShowingMyReactions() { this.showingMyReactions = !this.showingMyReactions; }\n\n  _toggleShowingComments() { this._showingComments = !this._showingComments; }\n\n  _renderMessageRow() {\n\n    return html`\n      <div class=\"post-message-block\">\n\n        ${this.post.hidden ? html`\n          <div class=\"sak-banner-info\">${this.post.canModerate ? this._i18n.moderator_hidden_message : this._i18n.hidden_message}</div>\n          ${this.post.canModerate ? html`\n            <div class=\"post-message\">${unsafeHTML(this.post.message)}</div>\n          ` : nothing }\n        ` : html`\n          <div class=\"post-message\">${unsafeHTML(this.post.message)}</div>\n        `}\n      </div>\n\n      <div>\n        ${this.post.canEdit || this.post.canDelete || this.post.canModerate ? html`\n          <div class=\"dropdown\">\n            <button class=\"btn btn-transparent\"\n                id=\"post-menu-${this.post.id}\"\n                type=\"button\"\n                data-bs-toggle=\"dropdown\"\n                title=\"${this._i18n.post_options_menu_tooltip}\"\n                aria-label=\"${this._i18n.post_options_menu_tooltip}\"\n                aria-haspopup=\"true\"\n                aria-expanded=\"false\">\n              <div><sakai-icon type=\"menu\" size=\"small\"></sakai-icon></div>\n            </button>\n            <ul class=\"dropdown-menu conv-dropdown-menu\" aria-labelledby=\"post-menu-${this.post.id}\">\n              ${this.post.canEdit ? html`\n              <li>\n                <button class=\"btn dropdown-item\"\n                    type=\"button\"\n                    @click=${this._setEditing}\n                    title=\"${this._i18n.edit_this_post}\"\n                    aria-label=\"${this._i18n.edit_this_post}\">\n                  ${this._i18n.edit}\n                </button>\n              </li>\n              ` : nothing }\n              ${this.post.canDelete ? html`\n              <li>\n                <button class=\"dropdown-item\"\n                    type=\"button\"\n                    @click=${this._deletePost}\n                    title=\"${this._i18n.delete_this_post}\"\n                    aria-label=\"${this._i18n.delete_this_post}\">\n                  ${this._i18n.delete}\n                </button>\n              </li>\n              ` : nothing }\n              ${this.post.canModerate ? html`\n              <li>\n                <button class=\"dropdown-item\"\n                    type=\"button\"\n                    @click=${this._toggleHidden}>\n                  ${this._i18n[this.post.hidden ? \"show\" : \"hide\"]}\n                </button>\n              </li>\n              <li>\n                <button class=\"dropdown-item\"\n                    type=\"button\"\n                    @click=${this._toggleLocked}>\n                  ${this._i18n[this.post.locked ? \"unlock\" : \"lock\"]}\n                </button>\n              </li>\n              ` : nothing }\n            </ul>\n          </div>\n        ` : nothing }\n      </div>\n    `;\n  }\n\n  _renderEditor() {\n\n    return html`\n      <div class=\"post-editor-block\">\n        <sakai-editor id=\"post-${this.post.id}-editor\" content=\"${this.post.message}\" set-focus></sakai-editor>\n        <div class=\"conv-private-checkbox-block\">\n          <label>\n            <input type=\"checkbox\" .checked=${this.post.privatePost} @click=${this._setPrivatePost} ?disabled=${this.post.parentIsPrivate}>\n            <span>${this._i18n.private_reply}</span>\n          </label>\n        </div>\n        <div class=\"act\">\n          <input type=\"button\" class=\"active\" @click=${this._publishPost} value=\"${this._i18n.publish}\">\n          <input type=\"button\" @click=${this._savePostAsDraft} value=\"${this._i18n.save_as_draft}\">\n          <input type=\"button\" @click=${this._unsetEditing} value=\"${this._i18n.cancel}\">\n        </div>\n      </div>\n    `;\n  }\n\n  _renderReplyEditor() {\n\n    return html`\n      <div class=\"post-reply-editor-block\">\n        <sakai-editor id=\"post-${this.post.id}-reply-editor\" set-focus></sakai-editor>\n        <div class=\"conv-private-checkbox-block\">\n          <label>\n            <input type=\"checkbox\" @click=${this._setPrivateReply} .checked=${this.post.privatePost} ?disabled=${this.post.privatePost}>\n            <span>${this._i18n.private_reply}</span>\n          </label>\n        </div>\n        <div class=\"act\">\n          <input type=\"button\" class=\"active\" @click=${this._replyToPostAsPublished} value=\"${this._i18n.publish}\">\n          <input type=\"button\" @click=${this._replyToPostAsDraft} value=\"${this._i18n.save_as_draft}\">\n          <input type=\"button\" @click=${this._unsetReplying} value=\"${this._i18n.cancel}\">\n        </div>\n      </div>\n    `;\n  }\n\n  _renderDiscussionPost() {\n\n    return html`\n\n      <div id=\"discussion-post-block-${this.post.id}\" class=\"discussion-post-block\">\n\n        <div class=\"discussion-post-left-column\">\n          <div class=\"photo\">\n            <sakai-user-photo\n                user-id=\"${this.post.anonymous && !this.canViewAnonymous ? \"blank\" : this.post.creator}\"\n                size-class=\"medium-thumbnail\"\n                profile-popup=\"on\"\n            >\n            </sakai-user-photo>\n          </div>\n          ${this.post?.posts?.length ? html`\n          <div class=\"discussion-post-vbar\">\n          </div>\n          ` : nothing }\n        </div>\n\n        <div class=\"discussion-post-right-column\">\n\n          <div class=\"discussion-post-content-wrapper ${!this.post.viewed ? \"new\" : nothing }\">\n            <div id=\"post-${this.post.id}\" class=\"discussion-post-content\" data-post-id=\"${this.post.id}\">\n              ${this._renderAuthorDetails()}\n              <div>\n              ${this.post.late && (this.isInstructor || this.post.isMine) ? html`\n              <div class=\"discussion-post-late\">${this._i18n.late}</div>\n              ` : nothing }\n              ${!this.post.viewed ? html`\n              <div class=\"discussion-post-new\">${this._i18n.new}</div>\n              ` : nothing }\n              </div>\n              ${this._editing ? html`\n                ${this._renderEditor()}\n              ` : html`\n              ${this._renderMessageRow()}\n              `}\n            </div>\n            ${this._editing ? \"\" : html`\n            <div class=\"discussion-post-bottom-bar\">\n              <div class=\"post-actions-block\">\n                ${this.post.canViewUpvotes ? html`\n                <div class=\"post-upvote-block\">\n                  ${this.post.canUpvote ? html`\n                  <a href=\"javascript:;\"\n                      @click=${this._toggleUpvotePost}\n                      aria-label=\"${this.post.upvoted ? this._i18n.downvote_tooltip : this._i18n.upvote_tooltip}\"\n                      title=\"${this.post.upvoted ? this._i18n.downvote_tooltip : this._i18n.upvote_tooltip}\"\n                      ?disabled=${!this.post.canUpvote}>\n                    ${this._renderUpvote()}\n                  </a>\n                  ` : this._renderUpvote()\n                  }\n                </div>\n                ` : nothing }\n              ${!this.post.hidden || this.post.canModerate ? html`\n                ${this._renderReactionsBlock()}\n                ${this.renderReactionsBar(this.post.reactionTotals)}\n              ` : nothing }\n              </div>\n              <div class=\"discussion-post-reply-options\">\n                ${this.post.canReply ? html`\n                <div>\n                  <a href=\"javascript:;\"\n                      @click=${this._toggleReplying}\n                      aria-label=\"${this._i18n.reply_tooltip}\"\n                      title=\"${this._i18n.reply_tooltip}\">\n                    ${this._i18n.reply}\n                  </a>\n                </div>\n                ` : nothing }\n                ${this.post.isThread && this.post.posts.length ? html`\n                <div class=\"discussion-post-toggle-replies\">\n                  <a href=\"javascript:;\"\n                      @click=${this._toggleExpanded}\n                      aria-label=\"${this._expanded ? this._i18n.hide_replies_tooltip : this._i18n.show_replies_tooltip}\"\n                      title=\"${this._expanded ? this._i18n.hide_replies_tooltip : this._i18n.show_replies_tooltip}\">\n                    <div class=\"post-replies-toggle-block\">\n                      <div class=\"post-replies-toggle-icon\">\n                        <sakai-icon\n                            type=\"${this._expanded ? \"chevron-down\" : \"chevron-up\"}\"\n                            size=\"small\">\n                        </sakai-icon>\n                      </div>\n                      <div>${this.post.posts.length} ${this.post.posts.length == 1 ? this._i18n.reply : this._i18n.replies}</div>\n                    </div>\n                  </a>\n                </div>\n                ` : nothing }\n              </div>\n            </div>\n            `}\n          </div>\n\n          ${this._replying ? html`\n          <div class=\"discussion-post-reply-block\">\n            <div class=\"photo\">\n              <sakai-user-photo\n                  user-id=\"${window.top.portal.user.id}\"\n                  classes=\"medium-thumbnail\"\n              >\n              </sakai-user-photo>\n            </div>\n            ${this._renderReplyEditor()}\n          </div>\n          ` : nothing }\n          ${this.post.depth % 5 === 0 && !this.post.continued ? html`\n            <a href=\"javascript:;\"\n                class=\"discussion-post-continue-block\"\n                @click=${this._continueThreadFromHere}>\n              <div>Continue this thread</div>\n              <div><sakai-icon type=\"right-arrow\" size=\"small\"></sakai-icon></div>\n            </a>\n          ` : html`\n\n            ${this.post.posts && this._expanded ? html`\n              ${this.post.posts.map(p => html`\n                <sakai-post\n                    post=\"${JSON.stringify(p)}\"\n                    postType=\"${this.postType}\"\n                    ?is-instructor=\"${this.isInstructor}\"\n                    ?can-view-anonymous=\"${this.canViewAnonymous}\"\n                    ?can-view-deleted=\"${this.canViewDeleted}\"\n                    site-id=\"${this.siteId}\"\n                    @comment-deleted=${this._commentDeleted}>\n                </sakai-post>\n              `)}\n            ` : nothing }\n          `}\n        </div>\n\n      </div>\n    `;\n  }\n\n  _renderReactionsBlock() {\n\n    return html`\n      <div class=\"reactions-block post-option\n          ${this.post.myReactions.GOOD_ANSWER ? \"good-answer-on\" : nothing }\n          ${this.post.isMine && this.post.reactionTotals.GOOD_ANSWER > 0 ? \"good-answer-on\" : nothing }\"\n      >\n        ${this.post.isMine && this.post.reactionTotals.GOOD_ANSWER > 0 ? html`\n        <div><sakai-icon type=\"thumbs-up\" size=\"small\"></sakai-icon></div>\n        <div>\n          ${this.post.type == QUESTION ? this._i18n.goodanswer : this._i18n.goodpost}\n          ${this.isInstructor && this.post.reactionTotals.GOOD_ANSWER ? ` - ${this.post.reactionTotals.GOOD_ANSWER}` : nothing }\n        </div>\n        ` : nothing }\n        ${!this.post.isMine && this.post.canReact ? html`\n        <div>\n        ${!this.post.locked && this.post.canReact ? html`\n          <a href=\"javascript:;\"\n              class=\"post-option\"\n              data-reaction=\"GOOD_ANSWER\"\n              @click=${this.toggleReaction}\n              aria-label=\"${this._getGoodAnswerTooltip()}\"\n              title=\"${this._getGoodAnswerTooltip()}\">\n            <div><sakai-icon type=\"thumbs-up\" size=\"small\"></sakai-icon></div>\n            <div>\n              ${this.post.type == QUESTION ? this._i18n.goodanswer : this._i18n.goodpost}\n              ${this.isInstructor && this.post.reactionTotals.GOOD_ANSWER ? ` - ${this.post.reactionTotals.GOOD_ANSWER}` : nothing }\n            </div>\n          </a>\n        ` : html`\n          ${this.post.type == QUESTION ? this._i18n.goodanswer : this._i18n.goodpost}\n          ${this.isInstructor && this.post.reactionTotals.GOOD_ANSWER ? ` - ${this.post.reactionTotals.GOOD_ANSWER}` : nothing }\n        `}\n        </div>\n        ` : nothing }\n      </div>\n\n      ${this.post.canReact ? html`\n      <div class=\"post-option single\">\n        <div class=\"dropdown\">\n          <button class=\"btn btn-transparent\"\n              id=\"post-reactions-${this.post.id}\"\n              type=\"button\"\n              @click=${this._toggleShowingMyReactions}\n              data-bs-toggle=\"dropdown\"\n              aria-label=\"${this._i18n.reactions_tooltip}\"\n              aria-expanded=\"false\"\n              title=\"${this._i18n.reactions_tooltip}\">\n            <sakai-icon type=\"smile\" size=\"small\"></sakai-icon>\n          </button>\n          <ul class=\"dropdown-menu conv-dropdown-menu\"\n              aria-labelledby=\"post-reactions-${this.post.id}\">\n            ${this.renderMyReactions(this.post.myReactions)}\n          </ul>\n        </div>\n      </div>\n      ` : nothing }\n    `;\n  }\n\n  _renderUpvote() {\n\n    return html`\n      <div class=\"post-upvote-container ${!this.post.upvotes ? \"no-votes\" : nothing }\"\n          title=\"${ifDefined(this.post.canUpvote ? \"\" : this.post.upvotes ? this.tr(\"upvote_count_tooltip\", [ this.post.upvotes ]) : this._i18n.no_upvotes_tooltip)}\">\n        <div>\n          <sakai-icon type=\"${this.post.upvoted ? \"down\" : \"up\"}\" size=\"smallest\"></sakai-icon>\n        </div>\n        <div>${this.post.upvotes || 0}</div>\n      </div>\n    `;\n  }\n\n  _renderQAPost() {\n\n    return html`\n      <div id=\"post-${this.post.id}\"\n          data-post-id=\"${this.post.id}\"\n          class=\"post ${this.post.isInstructor ? \"instructor\" : nothing }\n          ${(!this.post.comments || !this.post.comments.length) && !this.post.canComment ? \"post-without-comment-block\" : nothing }\">\n\n        <div class=\"post-topbar\">\n          <div class=\"photo\">\n            <sakai-user-photo\n                user-id=\"${this.post.anonymous && !this.canViewAnonymous ? \"blank\" : this.post.creator}\"\n                classes=\"medium-thumbnail\"\n                profile-popup=\"on\">\n            </sakai-user-photo>\n          </div>\n          ${this._renderAuthorDetails()}\n          ${this.post.late && (this.isInstructor || this.post.isMine) ? html`\n          <div class=\"discussion-post-late\">late</div>\n          ` : nothing }\n          ${this.post.isInstructor ? html`\n          <div class=\"conv-instructors-answer\">${this._i18n.instructors_answer}</div>\n          ` : nothing }\n        </div>\n\n        <div class=\"post-main\">\n          <div>\n          </div>\n          ${this._renderMessageRow()}\n        </div>\n\n        ${this._editing ? html`\n          ${this._renderEditor()}\n        ` : html`\n        <div class=\"post-reactions-comment-toggle-block\">\n          ${this.post.canViewUpvotes ? html`\n            <div class=\"post-upvote-block\">\n              ${this.post.canUpvote ? html`\n              <a href=\"javascript:;\"\n                  @click=${this._toggleUpvotePost}\n                  aria-label=\"${this.post.upvoted ? this._i18n.downvote_tooltip : this._i18n.upvote_tooltip}\"\n                  title=\"${this.post.upvoted ? this._i18n.downvote_tooltip : this._i18n.upvote_tooltip}\"\n                  ?disabled=${!this.post.canUpvote}>\n                ${this._renderUpvote()}\n              </a>\n              ` : this._renderUpvote()\n              }\n            </div>\n          ` : nothing }\n          <div class=\"post-actions-block\">\n            ${this._renderReactionsBlock()}\n            ${this.renderReactionsBar(this.post.reactionTotals)}\n          </div>\n          <div class=\"ms-auto\">\n          ${this.post.numberOfComments > 0 ? html`\n          <a href=\"javascript:;\"\n              aria-label=\"${this._showingComments ? this._i18n.hide_comments_tooltip : this._i18n.show_comments_tooltip}\"\n              title=\"${this._showingComments ? this._i18n.hide_comments_tooltip : this._i18n.show_comments_tooltip}\"\n              @click=${this._toggleShowingComments}>\n            <div class=\"post-comment-toggle-block\">\n              <div class=\"post-comment-toggle-icon\">\n                <sakai-icon\n                    type=\"${this._showingComments ? \"chevron-down\" : \"chevron-up\"}\"\n                    size=\"small\">\n                </sakai-icon>\n              </div>\n              <div>${this.post.numberOfComments} ${this.post.numberOfComments == 1 ? this._i18n.comment : this._i18n.comments}</div>\n            </div>\n          </a>\n          ` : nothing }\n          </div>\n        </div>\n        `}\n      </div>\n\n      <div class=\"post-comments-block\">\n        ${this._showingComments && this.post.comments && this.post.numberOfComments > 0 ? html`\n        <div class=\"post-comments\">\n        ${this.post.comments.map(c => html`\n          <sakai-comment\n              comment=\"${JSON.stringify(c)}\"\n              topic-id=\"${this.post.topic}\"\n              site-id=\"${this.siteId}\"\n              @comment-updated=${this._commentUpdated}\n              @comment-deleted=${this.commentDeleted}>\n          </sakai-comment>\n        `)}\n        </div>\n        ` : nothing }\n        ${this.post.canComment ? html`\n        <div class=\"post-add-comment-block\">\n          <div>\n            <sakai-user-photo user-id=\"${window.top.portal.user.id}\" classes=\"medium-thumbnail\">\n            </sakai-user-photo>\n          </div>\n          <div>\n            <sakai-comment-editor\n                post-id=\"${this.post.id}\"\n                site-id=\"${this.siteId}\"\n                topic-id=\"${this.post.topic}\"\n                @comment-created=${this._commentCreated}>\n            </sakai-comment-editor>\n          </div>\n        </div>\n        ` : nothing }\n      </div>\n    `;\n  }\n\n  shouldUpdate() {\n    return this._i18n && this.post;\n  }\n\n  updated() {\n\n    if (typeof MathJax !== \"undefined\") {\n      MathJax.Hub.Queue([ \"Typeset\", MathJax.Hub ]);\n    }\n  }\n\n  render() {\n    return this.postType === QUESTION ? this._renderQAPost() : this._renderDiscussionPost();\n  }\n}\n", "import { SakaiPost } from './src/SakaiPost.js';\n\ncustomElements.define('sakai-post', SakaiPost);\n", "import { html, nothing } from \"lit\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport \"@sakai-ui/sakai-user-photo\";\nimport { findPost, markThreadViewed } from \"./utils.js\";\nimport { reactionsMixin } from \"./reactions-mixin.js\";\nimport \"@sakai-ui/sakai-editor/sakai-editor.js\";\nimport \"../sakai-post.js\";\nimport { GROUP, INSTRUCTORS, DISCUSSION, QUESTION, SORT_OLDEST, SORT_NEWEST, SORT_ASC_CREATOR, SORT_DESC_CREATOR, SORT_MOST_ACTIVE, SORT_LEAST_ACTIVE } from \"./sakai-conversations-constants.js\";\nimport \"@sakai-ui/sakai-icon\";\n\nexport class SakaiTopic extends reactionsMixin(SakaiElement) {\n\n  static properties = {\n\n    topic: { type: Object },\n    postId: { attribute: \"post-id\", type: String },\n    isInstructor: { attribute: \"is-instructor\", type: Boolean },\n    canViewAnonymous: { attribute: \"can-view-anonymous\", type: Boolean },\n    canViewDeleted: { attribute: \"can-view-deleted\", type: Boolean },\n\n    _postEditorDisplayed: { state: true },\n    _replying: { state: true },\n    _i18n: { state: true },\n  };\n\n  constructor() {\n\n    super();\n\n    this.sort = SORT_OLDEST;\n\n    const options = {\n      root: null,\n      rootMargin: \"0px\",\n      threshold: 1.0,\n    };\n\n    this.observer = new IntersectionObserver((entries, observer) => {\n\n      const postIds = entries.filter(entry => entry.isIntersecting).map(entry => entry.target.dataset.postId);\n\n      if (postIds) {\n        const url = this.topic.links.find(l => l.rel === \"markpostsviewed\").href;\n        fetch(url, {\n          method: \"POST\",\n          credentials: \"include\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(postIds),\n        })\n        .then(r => {\n\n          if (r.ok) {\n            // Posts marked. Now unobserve them. We don't want to keep triggering this fetch\n            postIds.forEach(postId => {\n\n              observer.unobserve(entries.find(e => e.target.dataset.postId === postId).target);\n              findPost(this.topic, { postId }).viewed = true;\n              this.requestUpdate();\n            });\n            this.dispatchEvent(new CustomEvent(\"posts-viewed\", { detail: { postIds, topicId: this.topic.id } }));\n          } else {\n            throw new Error(\"Network error while marking posts as viewed\");\n          }\n        })\n        .catch(error => console.error(error));\n      }\n\n    }, options);\n\n\n    this.loadTranslations(\"conversations\").then(r => this._i18n = r);\n  }\n\n  set topic(value) {\n\n    const oldValue = this._topic;\n\n    this._topic = value;\n\n    this._postEditorDisplayed = false;\n\n    this.myReactions = value.myReactions || {};\n\n    const sortAndUpdate = () => {\n\n      if (this.topic.type === QUESTION) {\n        this.topic.posts.sort((p1, p2) => {\n\n          if (p1.isInstructor && p2.isInstructor) return 0;\n          if (p1.isInstructor && !p2.isInstructor) return -1;\n          return 1;\n        });\n      }\n\n      this.page = 0;\n\n      if (this.postId) {\n        const post = findPost(this.topic, { postId: this.postId });\n        if (post.parentThread) {\n          const thread = findPost(this.topic, { postId: post.parentThread });\n          thread.keepExpanded = true;\n        }\n      }\n\n      this.requestUpdate(\"topic\", oldValue);\n\n      this.updateComplete.then(() => {\n\n        if (this.postId) {\n          const el = this.querySelector(`#post-${this.postId}`);\n          el && (el.scrollIntoView());\n        }\n\n        // We have to use a timeout for this to satisfy Safari. updateComplete does not fulfil after\n        // the full render has happened on Safari, so the elements may well not be there.\n        setTimeout(() => { this._registerPosts(this.topic.posts); }, 100);\n      });\n    };\n\n    if (!this.topic.posts && (!this.topic.mustPostBeforeViewing || this.topic.canPost)) {\n      this._getPosts(this.topic, 0, SORT_OLDEST, this.postId).then(posts => {\n\n        this.topic.posts = posts;\n\n        // We've clicked on a topic and it has no posts. Ergo, it has been \"viewed\".\n        if (!this.topic.posts.length) this.topic.viewed = true;\n\n        sortAndUpdate();\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic, dontUpdateCurrent: true }, bubbles: true }));\n      });\n    } else {\n      sortAndUpdate();\n    }\n  }\n\n  get topic() { return this._topic; }\n\n  _savePostAsDraft() { this._postToTopic(true); }\n\n  _publishPost() { this._postToTopic(false); }\n\n  _postToTopic(draft) {\n\n    const postData = {\n      message: document.getElementById(`topic-${this.topic.id}-post-editor`).getContent(),\n      topic: this.topic.id,\n      siteId: this.topic.siteId,\n      privatePost: document.getElementById(\"conv-post-editor-private-checkbox\").checked,\n      anonymous: this.topic.allowAnonymousPosts && document.getElementById(\"conv-post-editor-anonymous-checkbox\").checked,\n      draft,\n      replyable: true,\n    };\n\n    const url = this.topic.links.find(l => l.rel === \"posts\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(postData),\n    })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(\"Network error while posting.\");\n      }\n      return r.json();\n    })\n    .then(post => {\n\n      if (post.isInstructor) this.topic.resolved = true;\n\n      this.topic.posts = this.topic.posts || [];\n      this.topic.posts.push(post);\n      this.topic.numberOfPosts += 1;\n      if (this.topic.mustPostBeforeViewing && !this.topic.hasPosted) {\n        // This user must have just posted to a post before viewing topic. We\n        // need to load up the posts.\n        this._getPosts(this.topic, 0, this.sort).then(posts => {\n\n          this.topic.posts = posts;\n          this.topic.hasPosted = true;\n          this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n        });\n      } else {\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n      }\n      this._postEditorDisplayed = false;\n      this._replying = false;\n\n      this.updateComplete.then(() => {\n\n        const el = this.querySelector(`#post-${post.id}`);\n        el && (el.scrollIntoView());\n      });\n    })\n    .catch (error => console.error(error));\n  }\n\n  _editTopic(e) {\n\n    e.preventDefault();\n    this.dispatchEvent(new CustomEvent(\"edit-topic\", { detail: { topic: this.topic }, bubbles: true }));\n  }\n\n  _commentDeleted(e) {\n\n    e.stopPropagation();\n\n    // Recast this event with the topic id added. The data is managed by sakai-conversations.js,\n    // and it needs the topic id to lookup the post with this comment.\n    this.dispatchEvent(new CustomEvent(\"comment-deleted\",\n      { detail: { topicId: this.topic.id, ...e.detail }, bubbles: true }));\n  }\n\n  _deleteTopic() {\n\n    if (!confirm(this._i18n.confirm_topic_delete)) return;\n\n    const url = this.topic.links.find(l => l.rel === \"delete\").href;\n    fetch(url, {\n      method: \"DELETE\",\n      credentials: \"include\",\n    })\n    .then(r => {\n\n      if (r.ok) {\n        this.dispatchEvent(new CustomEvent(\"topic-deleted\", { detail: { topic: this.topic }, bubbles: true }));\n      } else {\n        throw new Error(`Network error while deleting topic with id ${this.topic.id}`);\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _toggleBookmarked() {\n\n    const url = this.topic.links.find(l => l.rel === \"bookmark\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.topic.bookmarked),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        this.topic.bookmarked = !this.topic.bookmarked;\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n      } else {\n        throw new Error(\"Network error while bookmarking topic\");\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _toggleLocked() {\n\n    const url = this.topic.links.find(l => l.rel === \"lock\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.topic.locked),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        return r.json();\n      }\n      throw new Error(\"Network error while locking/unlocking topic\");\n\n    })\n    .then(topic => {\n\n      topic.selected = true;\n      this._getPosts(topic).then(posts => {\n\n        topic.posts = posts;\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic }, bubbles: true }));\n      });\n    })\n    .catch(error => console.error(error));\n  }\n\n  _toggleHidden() {\n\n    const url = this.topic.links.find(l => l.rel === \"hide\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.topic.hidden),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        this.topic.hidden = !this.topic.hidden;\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n      } else {\n        throw new Error(\"Network error while hiding/showing topic\");\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _togglePinned() {\n\n    const url = this.topic.links.find(l => l.rel === \"pin\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(!this.topic.pinned),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        this.topic.pinned = !this.topic.pinned;\n        this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n      } else {\n        throw new Error(\"Network error while pinning topic\");\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _postReactions() {\n\n    const url = this.topic.links.find(l => l.rel === \"react\").href;\n    fetch(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(this.myReactions),\n    })\n    .then(r => {\n\n      if (r.ok) {\n        return r.json();\n      }\n      throw new Error(\"Network error while posting topic.myReactions\");\n\n    })\n    .then(reactionTotals => {\n\n      this.topic.myReactions = this.myReactions;\n      this.topic.reactionTotals = reactionTotals;\n      this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n    })\n    .catch(error => console.error(error));\n  }\n\n  _postUpdated(e) {\n\n    e.stopPropagation();\n\n    const post = findPost(this.topic, { postId: e.detail.post.id });\n    post && (Object.assign(post, e.detail.post));\n\n    if (this.topic.continued) {\n      // We need this as we may be viewing a continued slice of the threaded posts. In other words\n      // we have two copies of the post in circulation, one in allPosts, one in posts.\n      const currentPost = findPost(this.topic, { postId: e.detail.post.id, postsInView: true });\n      currentPost && (Object.assign(currentPost, e.detail.post));\n    }\n\n    if (post.isThread) {\n      post.keepExpanded = true;\n    }\n\n    if (e.detail.created) this.topic.numberOfPosts += 1;\n\n    if (post.parentThread) {\n      const thread = findPost(this.topic, { postId: post.parentThread });\n      thread.keepExpanded = true;\n      if (e.detail.created && !e.detail.post.draft) {\n        thread.numberOfThreadReplies += 1;\n      }\n    }\n\n    if (this.topic.type === QUESTION) {\n      const numberOfInstructorPosts = findPost(this.topic, { isInstructor: true });\n      this.topic.resolved = numberOfInstructorPosts > 0;\n    }\n\n    this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n  }\n\n  _postDeleted(e) {\n\n    e.stopPropagation();\n\n    let index = this.topic.posts.findIndex(p => p.id === e.detail.post.id);\n    if (index !== -1) {\n      // This is a thread post, a direct reply to the topic.\n      this.topic.posts.splice(index, 1);\n    } else {\n      // This is a reply to a post, so it has a parent\n      const parentPost = findPost(this.topic, { postId: e.detail.post.parentPost });\n      index = parentPost.posts.findIndex(p => p.id === e.detail.post.id);\n      parentPost.posts.splice(index, 1);\n\n      // Update the read status of the top level thread\n      const thread = findPost(this.topic, { postId: e.detail.post.parentThread });\n      thread && (markThreadViewed(thread));\n      thread && (thread.numberOfThreadReplies -= 1);\n    }\n\n    this.topic.numberOfPosts = this.topic.numberOfPosts <= 0 ? 0 : this.topic.numberOfPosts - 1;\n\n    this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n  }\n\n  _continueThread(e) {\n\n    e.detail.post.continued = true;\n    const thread = findPost(this.topic, { postId: e.detail.post.parentThread });\n    thread.keepExpanded = true;\n    if (!this.topic.allPosts) {\n      this.topic.allPosts = [ ...this.topic.posts ];\n    }\n    this.topic.posts = [ e.detail.post ];\n    this.topic.continued = true;\n    this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n    this.updateComplete.then(() => {\n\n      const el = this.querySelector(`#post-${e.detail.post.id}`);\n      el && (el.scrollIntoView());\n    });\n  }\n\n  _viewAllPosts() {\n\n    this.topic.posts = [ ...this.topic.allPosts ];\n    this.topic.allPosts = undefined;\n    this.topic.continued = false;\n    this.dispatchEvent(new CustomEvent(\"topic-updated\", { detail: { topic: this.topic }, bubbles: true }));\n  }\n\n  _registerPosts(posts) {\n\n    if (posts) {\n      posts.forEach(p => {\n\n        if (!p.viewed) {\n          this.observer.observe(this.querySelector(`#post-${p.id}`));\n        }\n\n        if (p.posts) {\n          this._registerPosts(p.posts);\n        }\n      });\n    }\n  }\n\n  _getMoreReplies() {\n\n    this.page += 1;\n\n    this._getPosts(this.topic, this.page, this.sort).then(posts => {\n\n      this.topic.posts = this.topic.posts.concat(posts);\n      this.requestUpdate();\n      this.updateComplete.then(() => {\n        setTimeout(() => { this._registerPosts(posts); }, 100);\n      });\n\n    });\n  }\n\n  _postSortSelected(e) {\n\n    this.sort = e.target.value;\n    this.page = 0;\n\n    this._getPosts(this.topic, this.page, this.sort).then(posts => {\n\n      this.topic.posts = posts;\n      this.requestUpdate();\n    });\n  }\n\n  _getPosts(topic, page = 0, sort = SORT_OLDEST, postId) {\n\n    const url = `${topic.links.find(l => l.rel === \"posts\").href}?page=${page}&sort=${sort}${\n       postId ? `&postId=${postId}` : \"\"}`;\n\n    return fetch(url, { credentials: \"include\" })\n    .then(r => {\n\n      if (!r.ok) {\n        throw new Error(`Network error while retrieving  posts for topic ${topic.id}`);\n      } else {\n        return r.json();\n      }\n    })\n    .catch(error => console.error(error));\n  }\n\n  _unsetReplying() { this._replying = false; }\n\n  _setReplying() { this._replying = true; }\n\n  _toggleShowingMyReactions() { this.showingMyReactions = !this.showingMyReactions; }\n\n  _renderPostEditor() {\n\n    return html`\n      <div class=\"conv-post-editor-wrapper\">\n        <div class=\"conv-post-editor-header\">\n          <span>${this.topic.type === QUESTION ? this._i18n.answer_this_question : this._i18n.reply_to}</span>\n          <span>${this.topic.title}</span>\n        </div>\n        <sakai-editor id=\"topic-${this.topic.id}-post-editor\" set-focus></sakai-editor>\n        <div class=\"conv-private-checkbox-block\">\n          <label>\n            <input id=\"conv-post-editor-private-checkbox\" type=\"checkbox\">${this._i18n.private_topic_reply}\n          </label>\n        </div>\n        ${this.topic.allowAnonymousPosts ? html`\n        <div class=\"conv-private-checkbox-block\">\n          <label>\n            <input id=\"conv-post-editor-anonymous-checkbox\" type=\"checkbox\">${this._i18n.post_anonymously}\n          </label>\n        </div>\n        ` : nothing }\n        <div class=\"act\">\n          <input type=\"button\" class=\"active\" @click=${this._publishPost} value=\"${this._i18n.publish}\">\n          <input type=\"button\" @click=${this._savePostAsDraft} value=\"${this._i18n.save_as_draft}\">\n          <input type=\"button\" @click=\"${this._unsetReplying}\" value=\"${this._i18n.cancel}\">\n        </div>\n      </div>\n    `;\n  }\n\n  shouldUpdate() {\n    return this._i18n && this.topic;\n  }\n\n  updated() {\n\n    if (typeof MathJax !== \"undefined\") {\n      MathJax.Hub.Queue([ \"Typeset\", MathJax.Hub ]);\n    }\n  }\n\n  render() {\n\n    return html`\n      <div class=\"topic\">\n        ${this.topic.draft ? html`\n        <div class=\"sak-banner-warn\">${this._i18n.draft_warning}</div>\n        ` : nothing }\n        ${this.topic.hidden ? html`\n        <div class=\"sak-banner-warn\">${this._i18n.topic_hidden}</div>\n        ` : nothing }\n        ${this.topic.locked ? html`\n        <div class=\"sak-banner-warn\">${this.topic.canModerate ? this._i18n.moderator_topic_locked : this._i18n.topic_locked}</div>\n        ` : nothing }\n        ${this.topic.visibility === INSTRUCTORS ? html`\n        <div class=\"sak-banner-warn\">${this._i18n.topic_instructors_only_tooltip}</div>\n        ` : nothing }\n        ${this.topic.visibility === GROUP ? html`\n        <div class=\"sak-banner-warn\">${this._i18n.topic_groups_only_tooltip}</div>\n        ` : nothing }\n        <div class=\"topic-tags\">\n          ${this.topic.tags.map(tag => html`\n            <div class=\"tag\">${tag.label}</div>\n          `)}\n        </div>\n        <div class=\"author-and-tools\">\n          <div class=\"author-block\">\n            <div><sakai-user-photo user-id=\"${this.topic.anonymous && !this.canViewAnonymous ? \"blank\" : this.topic.creator}\" profile-popup=\"on\"></sakai-user-photo></div>\n            <div>\n              <div class=\"author-details\">\n                <div class=\"topic-creator-name\">${this.topic.creatorDisplayName}</div>\n                <div class=\"topic-question-asked\">${this.topic.type === QUESTION ? this._i18n.asked : this._i18n.posted}</div>\n                <div class=\"topic-created-date\">${this.topic.formattedCreatedDate}</div>\n              </div>\n            </div>\n          </div>\n          <div class=\"topic-options-menu\">\n          ${this.topic.canModerate || this.topic.canEdit || this.topic.canDelete || this.topic.canViewStatistics ? html`\n            <div class=\"dropdown\">\n              <button class=\"btn btn-transparent\"\n                  id=\"topic-options-toggle-${this.topic.id}\"\n                  type=\"button\"\n                  title=\"${this._i18n.topic_options_menu_tooltip}\"\n                  data-bs-toggle=\"dropdown\"\n                  aria-expanded=\"false\"\n                  aria-haspopup=\"true\"\n                  aria-label=\"${this._i18n.topic_options_menu_tooltip}\">\n                <sakai-icon type=\"menu\" size=\"small\"></sakai-icon>\n              </button>\n              <ul class=\"dropdown-menu conv-dropdown-menu\"\n                  aria-labelledby=\"topic-options-toggle-${this.topic.id}\">\n\n                ${this.topic.canEdit ? html`\n                <li>\n                  <button type=\"button\"\n                      class=\"dropdown-item\"\n                      @click=${this._editTopic}\n                      aria-label=\"${this._i18n.edit_topic_tooltip}\"\n                      title=\"${this._i18n.edit_topic_tooltip}\">\n                    ${this._i18n.edit}\n                  </button>\n                </li>\n                ` : nothing }\n\n                ${this.topic.canDelete ? html`\n                <li>\n                  <button type=\"button\"\n                      class=\"dropdown-item\"\n                      @click=${this._deleteTopic}\n                      aria-label=\"${this._i18n.delete_topic_tooltip}\"\n                      title=\"${this._i18n.delete_topic_tooltip}\">\n                    ${this._i18n.delete}\n                  </button>\n                </li>\n                ` : nothing }\n\n                ${this.topic.canModerate ? html`\n                <li>\n                  <button type=\"button\"\n                      class=\"dropdown-item\"\n                      aria-label=\"${this._i18n[this.topic.hidden ? \"show_topic_tooltip\" : \"hide_topic_tooltip\"]}\"\n                      title=\"${this._i18n[this.topic.hidden ? \"show_topic_tooltip\" : \"hide_topic_tooltip\"]}\"\n                      @click=${this._toggleHidden}>\n                    ${this._i18n[this.topic.hidden ? \"show\" : \"hide\"]}\n                  </button>\n                </li>\n                <li>\n                  <button type=\"button\"\n                      class=\"dropdown-item\"\n                      href=\"javascript:;\"\n                      aria-label=\"${this._i18n[this.topic.locked ? \"unlock_topic_tooltip\" : \"lock_topic_tooltip\"]}\"\n                      title=\"${this._i18n[this.topic.locked ? \"unlock_topic_tooltip\" : \"lock_topic_tooltip\"]}\"\n                      @click=${this._toggleLocked}>\n                    ${this._i18n[this.topic.locked ? \"unlock\" : \"lock\"]}\n                  </button>\n                </li>\n                ` : nothing }\n                ${this.topic.canViewStatistics ? html`\n                <li>\n                  <button type=\"button\"\n                      class=\"dropdown-item\"\n                      href=\"javascript:;\"\n                      @click=${this.showStatistics}>\n                    ${this._i18n.view_statistics}\n                  </button>\n                </li>\n                ` : nothing }\n              </ul>\n            </div>\n            ` : nothing }\n          </div>\n        </div>\n        <div class=\"topic-title-and-status\">\n          <div class=\"topic-title-wrapper\">\n            <div class=\"topic-title\">${this.topic.title}</div>\n          </div>\n          ${this.topic.type === QUESTION ? html`\n          <div class=\"topic-status-icon-and-text\">\n            <div class=\"topic-status-icon\">\n              ${this.topic.resolved ? html`\n                <sakai-icon type=\"check_circle\"\n                    class=\"answered-icon\"\n                    title=\"${this._i18n.answered_tooltip}\">\n                </sakai-icon>\n              ` : html`\n                <sakai-icon type=\"questioncircle\"\n                    class=\"unanswered-icon\"\n                    title=\"${this._i18n.unanswered_tooltip}\">\n                </sakai-icon>\n              `}\n            </div>\n            <div class=\"topic-status-text\">${this._i18n[this.topic.resolved ? \"answered\" : \"unanswered\"]}</div>\n          </div>\n          ` : nothing }\n        </div>\n        ${this.topic.formattedDueDate ? html`\n        <div id=\"topic-duedate-block\"><span>${this._i18n.duedate_label}</span><span>${this.topic.formattedDueDate}</span></div>\n        ` : nothing }\n        <div class=\"topic-message\">${unsafeHTML(this.topic.message)}</div>\n        ${this.topic.draft ? \"\" : html`\n        <div class=\"topic-message-bottom-bar\">\n          ${this.topic.canBookmark ? html`\n          <div>\n            <a href=\"javascript:;\"\n                @click=${this._toggleBookmarked}\n                aria-label=\"${this._i18n[this.topic.bookmarked ? \"unbookmark_tooltip\" : \"bookmark_tooltip\"]}\"\n                title=\"${this._i18n[this.topic.bookmarked ? \"unbookmark_tooltip\" : \"bookmark_tooltip\"]}\"\n            >\n              <div class=\"topic-option\">\n                <div><sakai-icon type=\"favourite\" size=\"small\"></sakai-icon></div>\n                <div>\n                  ${this._i18n[this.topic.bookmarked ? \"unbookmark\" : \"bookmark\"]}\n                </div>\n              </div>\n            </a>\n          </div>\n          ` : nothing }\n          ${this.topic.canPin ? html`\n          <div>\n            <a href=\"javascript:;\"\n                @click=${this._togglePinned}\n                aria-label=\"${this.topic.pinned ? this._i18n.unpin_tooltip : this._i18n.pin_tooltip}\"\n                title=\"${this.topic.pinned ? this._i18n.unpin_tooltip : this._i18n.pin_tooltip}\">\n              <div class=\"topic-option\">\n                <div><sakai-icon type=\"pin\" size=\"small\"></sakai-icon></div>\n                <div>\n                  ${this._i18n[this.topic.pinned ? \"unpin\" : \"pin\"]}\n                </div>\n              </div>\n            </a>\n          </div>\n          ` : nothing }\n          ${this.topic.type === QUESTION ? html`\n          <div>\n            <div class=\"topic-option\n                ${this.topic.myReactions.GOOD_QUESTION ? \"good-question-on\" : \"\"}\n                ${this.topic.isMine && this.topic.reactionTotals.GOOD_QUESTION > 0 ? \"reaction-on\" : \"\"}\"\n            >\n              ${this.topic.isMine && this.topic.reactionTotals.GOOD_QUESTION > 0 ? html`\n                <div><sakai-icon type=\"thumbs-up\" size=\"small\"></sakai-icon></div>\n                <div>\n                ${this._i18n.goodquestion} ${this.isInstructor && this.topic.reactionTotals.GOOD_QUESTION ? ` - ${this.topic.reactionTotals.GOOD_QUESTION}` : \"\"}\n                </div>\n              ` : nothing }\n              ${!this.topic.isMine ? html`\n              <div><sakai-icon type=\"thumbs-up\" size=\"small\"></sakai-icon></div>\n              <div>\n                <a href=\"javascript:;\"\n                    data-reaction=\"GOOD_QUESTION\"\n                    @click=${this.toggleReaction}\n                    aria-label=\"${this.topic.myReactions.GOOD_QUESTION ? this._i18n.ungoodquestion_tooltip : this._i18n.goodquestion_tooltip}\"\n                    title=\"${this.topic.myReactions.GOOD_QUESTION ? this._i18n.ungoodquestion_tooltip : this._i18n.goodquestion_tooltip}\">\n                  ${this._i18n.goodquestion} ${this.isInstructor && this.topic.reactionTotals.GOOD_QUESTION ? ` - ${this.topic.reactionTotals.GOOD_QUESTION}` : \"\"}\n                </a>\n              </div>\n              ` : nothing }\n            </div>\n          </div>\n          ` : nothing }\n          ${this.topic.canReact ? html`\n          <div class=\"reactions-block\">\n            <div class=\"topic-option\">\n              <div class=\"dropdown\">\n                <button class=\"btn btn-transparent\"\n                    id=\"topic-reactions-id-${this.topic.id}\"\n                    type=\"button\"\n                    aria-expanded=\"false\"\n                    data-bs-toggle=\"dropdown\">\n                  <sakai-icon type=\"smile\" size=\"small\"></sakai-icon>\n                </button>\n                <ul class=\"dropdown-menu conv-dropdown-menu\" aria-labelledby=\"topic-reactions-${this.topic.id}\">\n                  ${this.renderMyReactions(this.topic.myReactions)}\n                </ul>\n              </div>\n            </div>\n            ${this.renderReactionsBar(this.topic.reactionTotals)}\n          </div>\n          ` : nothing }\n          <div>\n            <div class=\"topic-option\">\n            </div>\n          </div>\n        </div>\n        <hr>\n        ${!this.topic.continued && !this.topic.locked ? html`\n        <div class=\"topic-reply-block ${!this._replying ? \"padded\" : \"\"}\">\n            ${this.topic.pastDueDate ? html`\n            <div class=\"sak-banner-warn\">${this._i18n.duedate_passed_info}</div>\n            ` : nothing }\n            ${this.topic.mustPostBeforeViewing && !this.topic.canPost ? html`\n            <div class=\"sak-banner-warn\">${this._i18n.post_before_viewing_message}</div>\n            ` : nothing }\n            ${this._replying ? html`\n              ${this._renderPostEditor()}\n            ` : html`\n            <a href=\"javascript:;\" @click=${this._setReplying}>\n              <div class=\"editor-placeholder\">\n                <div><sakai-user-photo user-id=\"${window.top.portal.user.id}\"></sakai-user-photo></div>\n                <div>${this.topic.type === QUESTION ? this._i18n.answer_this_question : this._i18n.reply_to}</div>\n                <div>${this.topic.title}</div>\n              </div>\n            </a>\n            `}\n          </div>\n        </div>\n        ` : nothing }\n        ${this.topic?.posts?.length ? html `\n          <div class=\"topic-posts-block\">\n            ${!this.topic.continued ? html`\n            <div class=\"topic-posts-header\">\n              <div>${this.topic.type === QUESTION ? this._i18n.answers : this._i18n.responses}</div>\n              ${this.topic.type === DISCUSSION ? html`\n              <div>\n                <select @change=${this._postSortSelected}>\n                  <option value=\"${SORT_OLDEST}\">oldest</option>\n                  <option value=\"${SORT_NEWEST}\">most recent</option>\n                  <option value=\"${SORT_ASC_CREATOR}\">ascending author</option>\n                  <option value=\"${SORT_DESC_CREATOR}\">descending author</option>\n                  <option value=\"${SORT_MOST_ACTIVE}\">most active</option>\n                  <option value=\"${SORT_LEAST_ACTIVE}\">least active</option>\n                </select>\n              </div>\n              ` : nothing }\n            </div>\n            ` : nothing }\n\n            ${this.topic.continued ? html`\n            <div id=\"conv-back-button-block\">\n              <a href=\"javascript:;\" @click=${this._viewAllPosts}>\n                <div><sakai-icon type=\"left-arrow\"></sakai-icon></div>\n                <div>${this._i18n.back_to_all}</div>\n              </a>\n            </div>\n            ` : nothing }\n            ${this.topic.posts.map(p => html`\n              ${p.canView ? html`\n              <sakai-post\n                  post=\"${JSON.stringify(p)}\"\n                  postType=\"${this.topic.type}\"\n                  ?is-instructor=\"${this.isInstructor}\"\n                  ?can-view-anonymous=\"${this.canViewAnonymous}\"\n                  ?can-view-deleted=\"${this.canViewDeleted}\"\n                  site-id=\"${this.topic.siteId}\"\n                  @post-updated=${this._postUpdated}\n                  @post-deleted=${this._postDeleted}\n                  @continue-thread=${this._continueThread}\n                  @comment-deleted=${this._commentDeleted}></sakai-post>\n              ` : nothing }\n            `)}\n          ${this.topic.numberOfThreads > this.topic.posts.length && !this.topic.continued ? html`\n          <div class=\"topic-more-replies-block\">\n            <a href=\"javascript:;\" @click=${this._getMoreReplies}>${this.topic.type === QUESTION ? this._i18n.more_answers : this._i18n.more_replies}</a>\n          </div>\n          ` : nothing }\n          </div>\n        ` : html`\n          ${this._postEditorDisplayed ? html`\n          <div>\n            ${this._renderPostEditor()}\n          </div>\n          ` : html`\n          `}\n        `}\n      `}\n      </div>\n    `;\n  }\n}\n", "import { SakaiTopic } from './src/SakaiTopic.js';\n\ncustomElements.define('sakai-topic', SakaiTopic);\n"],
  "mappings": "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",
  "names": ["flattenPosts", "startPosts", "posts", "p", "findPost", "topic", "options", "flattened", "markThreadViewed", "thread", "reactionsMixin", "Base", "myReactions", "reactionIcons", "ke", "pair", "reactionTotals", "e", "reaction", "SakaiCommentEditor", "SakaiElement", "loadProperties", "r", "value", "editor", "isNew", "postId", "url", "comment", "error", "ke", "to", "SakaiCommentEditor", "SakaiComment", "SakaiElement", "r", "url", "error", "e", "ke", "D", "ae", "SakaiComment", "SakaiPost", "reactionsMixin", "SakaiElement", "r", "value", "old", "thread", "transformAll", "posts", "flattened", "p", "url", "l", "reactionTotals", "error", "post", "draft", "reply", "currentMessage", "editor", "e", "comment", "c", "commentId", "index", "ke", "D", "QUESTION", "DISCUSSION", "ae", "to", "SakaiPost", "SakaiTopic", "reactionsMixin", "SakaiElement", "SORT_OLDEST", "options", "entries", "observer", "postIds", "entry", "url", "l", "r", "postId", "e", "findPost", "error", "value", "oldValue", "sortAndUpdate", "QUESTION", "p1", "p2", "post", "thread", "el", "posts", "draft", "postData", "topic", "reactionTotals", "currentPost", "numberOfInstructorPosts", "index", "p", "parentPost", "markThreadViewed", "page", "sort", "ke", "D", "INSTRUCTORS", "GROUP", "tag", "ae", "DISCUSSION", "SORT_NEWEST", "SORT_ASC_CREATOR", "SORT_DESC_CREATOR", "SORT_MOST_ACTIVE", "SORT_LEAST_ACTIVE", "SakaiTopic"]
}
