{
  "version": 3,
  "sources": ["../node_modules/@sakai-ui/sakai-lti-iframe/src/SakaiLTIIframe.js", "../node_modules/@sakai-ui/sakai-lti-iframe/sakai-lti-iframe.js"],
  "sourcesContent": ["import { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport { html } from \"lit\";\n\nexport class SakaiLTIIframe extends SakaiElement {\n\n  static properties = {\n\n    allowResize: { attribute: \"allow-resize\", type: String },\n    newWindowText: { attribute: \"new-window-text\", type: String },\n    launchUrl: { attribute: \"launch-url\", type: String },\n  };\n\n  constructor() {\n\n    super();\n\n    const randomId = Math.floor(Math.random() * 1000000);\n    this.randomId = randomId;\n    this.newWindowText = null;\n\n    this.loadTranslations(\"lti\").then(t => {\n\n      this.i18n = t;\n      if ( this.newWindowText == null ) this.newWindowText = this.i18n.new_window_text;\n      this.requestUpdate();\n    });\n\n    setTimeout(elem => {\n\n      console.debug(\"elem\", elem);\n      if ( typeof elem == \"undefined\" ) return;\n      console.debug(\"timeout check\", elem.randomId, elem.launchUrl);\n      // Only check off-server launches\n      if ( elem.launchUrl.indexOf(\"http://\") != 0 && elem.launchUrl.indexOf(\"https://\") != 0 ) return;\n\n      console.debug(\"Actually checking...\");\n\n      const myframe = document.getElementById(`sakai-lti-iframe-${elem.randomId}`);\n      const mybutton = document.getElementById(`sakai-lti-button-${elem.randomId}`);\n      let loaded = false;\n\n      try {\n        const iframeLoc = String(myframe.contentWindow.location);\n        console.debug(\"iframeLoc\", iframeLoc);\n        const windowLoc = window.location.href;\n        window.console && console.debug(\"iframe.location=\", windowLoc);\n        let ipos = -1;\n        let slashcount = 0;\n        for (let i = 0; i < windowLoc.length; i++) {\n          if ( windowLoc[i] == \"/\" ) slashcount++;\n          if ( slashcount == 3 ) {\n            ipos = i;\n            break;\n          }\n        }\n        if ( ipos == -1 ) {\n          loaded = false;\n        } else {\n          const prefix = windowLoc.substring(0, ipos);\n          window.console && console.debug(\"iframe.prefix=\", prefix);\n          loaded = iframeLoc.indexOf(prefix) == 0;\n        }\n      } catch (ex) { // This is an expected/normal/hoped for occurance\n        console.debug(\"rationalize iframe with window href, \" + ex);\n        loaded = true;\n      }\n      if ( ! loaded ) {\n        mybutton.show();\n      } else {\n        window.console && console.debug(\"load success\", elem.launchUrl);\n      }\n    }, 3000, this);\n\n    window.addEventListener(\"message\", e => {\n\n      try {\n        const idval = `sakai-lti-iframe-${randomId}`; // https://stackoverflow.com/questions/15329710/postmessage-source-iframe\n\n        let frameId = false;\n        let allowResize = false;\n        Array.from(document.getElementsByTagName(\"iframe\")).forEach(element => {\n          if ( element.contentWindow === event.source ) {\n            frameId = element.id;\n            allowResize = element.dataset.allowResize;\n          }\n        });\n        if ( frameId != idval ) return; // The message is from our frame\n        if ( allowResize != \"yes\" ) return;\n\n        let message = e.data;\n        if ( typeof message == \"string\" ) message = JSON.parse(e.data);\n        if ( message.subject == \"lti.frameResize\" ) {\n          const height = message.height;\n          document.getElementById(idval).height = height;\n          console.debug(`Received lti.frameResize height=${height} frame=${idval}`);\n        }\n      } catch (error) {\n        console.debug(error);\n      }\n    });\n  }\n\n  shouldUpdate() {\n    return this.i18n && this.newWindowText && this.launchUrl;\n  }\n\n  launchPopup() {\n\n    window.open(this.launchUrl, \"_blank\");\n    return false;\n  }\n\n  render() {\n\n    return html`\n      <div class=\"sakai-iframe-launch-button\" id=\"sakai-lti-button-${this.randomId}\" style=\"display:none;\">\n        <p>\n          <button @click=\"${this.launchPopup}\" class=\"btn btn-primary\">${this.newWindowText}</button>\n        </p>\n      </div>\n      <div class=\"sakai-iframe-launch\">\n        <iframe src=\"${this.launchUrl}\"\n            id=\"sakai-lti-iframe-${this.randomId}\"\n            style=\"width: 100%; height: 100%; min-height: 80vh;\"\n            width=\"100%\"\n            aria-label=\"${this.newWindowText}\"\n            frameborder=\"0\"\n            marginwidth=\"0\"\n            data-allow-resize=\"${this.allowResize}\"\n            marginheight=\"0\"\n            scrolling=\"auto\"\n            allow=\"camera; fullscreen; microphone\">\n        </iframe>\n      </div>\n    `;\n  }\n}\n", "import { SakaiLTIIframe } from './src/SakaiLTIIframe.js';\n\ncustomElements.define('sakai-lti-iframe', SakaiLTIIframe);\n"],
  "mappings": "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",
  "names": ["SakaiLTIIframe", "SakaiElement", "randomId", "t", "elem", "myframe", "mybutton", "loaded", "iframeLoc", "windowLoc", "ipos", "slashcount", "i", "prefix", "ex", "idval", "frameId", "allowResize", "element", "message", "height", "error", "ke", "SakaiLTIIframe"]
}
