{
  "version": 3,
  "sources": ["../node_modules/@sakai-ui/sakai-permissions/src/SakaiPermissions.js", "../node_modules/@sakai-ui/sakai-permissions/sakai-permissions.js"],
  "sourcesContent": ["import { SakaiElement } from \"@sakai-ui/sakai-element\";\nimport { html, nothing } from \"lit\";\nimport { getSiteId } from \"@sakai-ui/sakai-portal-utils\";\nimport \"@sakai-ui/sakai-group-picker\";\n\nexport class SakaiPermissions extends SakaiElement {\n\n  static properties = {\n\n    tool: { type: String },\n    reference: { type: String },\n    disableGroups: { attribute: \"disabled-groups\", type: Boolean },\n    bundleKey: { attribute: \"bundle-key\", type: String },\n    onRefresh: { attribute: \"on-refresh\", type: String },\n    fireEvent: { attribute: \"fire-event\", type: Boolean },\n\n    roles: { state: true },\n    groups: { state: true },\n    error: { state: true },\n    i18n: { state: true },\n  };\n\n  constructor() {\n\n    super();\n\n    this.loadTranslations(\"permissions-wc\").then(i18n => {\n\n      this.loadTranslations(this.bundleKey ? this.bundleKey : this.tool).then(tool => {\n\n        Object.keys(tool).filter(k => k.startsWith(\"perm-\")).forEach(k => i18n[k.substring(5)] = tool[k]);\n        this.i18n = i18n;\n      });\n    });\n  }\n\n  connectedCallback() {\n\n    super.connectedCallback();\n\n    this.reference = this.reference || `/site/${getSiteId()}`;\n\n    this._loadPermissions();\n  }\n\n  _handleDescriptionClick(e) {\n\n    e.preventDefault();\n\n    const all = this.querySelectorAll(`input[data-perm='${e.target.dataset.perm}']`);\n    const checked = this.querySelectorAll(`input[data-perm='${e.target.dataset.perm}']:checked`);\n\n    if (checked.length < all.length || checked.length === 0) {\n      all.forEach(i => i.checked = true);\n    } else if (checked.length === all.length) {\n      all.forEach(i => i.checked = false);\n    }\n  }\n\n  _handlePermissionChange(e) {\n    e.target.closest(\"div\").classList.toggle(\"active\", e.target.checked);\n  }\n\n  _handleRoleHover(e, type) {\n\n    const role = e.target.dataset.role.replace(\".\", \"\\\\.\");\n    this.querySelectorAll(`div.${role.replace(\" \", \"_\")}-checkbox-cell`).forEach(cell => {\n      cell.classList.toggle(\"row-hover\", type === \"mouseenter\");\n    });\n  }\n\n  _handleRoleMouseEnter(e) {\n    this._handleRoleHover(e, \"mouseenter\");\n  }\n\n  _handleRoleMouseLeave(e) {\n    this._handleRoleHover(e, \"mouseleave\");\n  }\n\n  _handleRoleClick(e) {\n\n    e.preventDefault();\n\n    const role = e.target.dataset.role.replace(\".\", \"\\\\.\");\n\n    const anyChecked = this.querySelectorAll(`#permissions-container .${role.replace(\" \", \"_\")}-checkbox-cell input:checked:not(:disabled)`).length > 0;\n    this.querySelectorAll(`#permissions-container .${role.replace(\" \", \"_\")}-checkbox-cell input:not(:disabled)`).forEach(i => i.checked = !anyChecked);\n  }\n\n  _handlePermissionClick(e) {\n\n    e.preventDefault();\n\n    const checked = this.querySelectorAll(\"#permissions-container input:checked\");\n\n    this.querySelectorAll(\"#permissions-container input\").forEach(input => {\n      input.checked = checked.length === 0;\n    });\n  }\n\n  firstUpdated() {\n\n    // Save the default selected\n    this.querySelectorAll(\"#permissions-container :checked\").forEach(el => {\n      el.closest(\"div\").classList.add(\"defaultSelected\");\n    });\n  }\n\n  shouldUpdate() {\n    return this.i18n;\n  }\n\n  render() {\n\n    if (this.roles) {\n      return html`\n\n        ${!this.reference && this.groups?.length > 0 ? html`\n          <div>\n            <label for=\"permissons-group-picker\">${this.i18n[\"per.lis.selectgrp\"]}</label>\n            <sakai-group-picker id=\"permissions-group-picker\"\n                groups=\"${JSON.stringify(this.groups)}\"\n                @group-selected=${this._groupSelected}>\n            </sakai-group-picker>\n          </div>\n        ` : nothing }\n        <div class=\"mb-1 pt-3\">\n          <button class=\"btn btn-secondary\"\n              aria-label=\"${this.i18n[\"per.lis.restoredef\"]}\"\n              @click=${this._resetPermissions}>\n            ${this.i18n[\"per.lis.restoredef\"]}\n          </button>\n        </div>\n\n        <div id=\"permissions-container\" class=\"container mt-4\">\n          <div id=\"permission-header\" class=\"row flex-nowrap\">\n            <div class=\"col-md-6 p-3\">\n              <button class=\"btn btn-transparent\"\n                  title=\"${this.i18n[\"per.lis.head.title\"]}\"\n                  @click=${this._handlePermissionClick}>\n                ${this.i18n[\"per.lis.head\"]}\n              </button>\n            </div>\n            ${this.roles.map(role => html`\n            <div class=\"col-sm role d-none d-md-block p-3 text-center\"\n                data-role=\"${role}\"\n                @mouseenter=${this._handleRoleMouseEnter}\n                @mouseleave=${this._handleRoleMouseLeave}>\n              <button class=\"btn btn-transparent\"\n                  title=\"${this.i18n[\"per.lis.role.title\"]}\"\n                  data-role=\"${role}\"\n                  @click=${this._handleRoleClick}>\n                ${this.roleNameMappings[role]}\n              </button>\n            </div>\n          `)}\n          </div>\n          ${this.available.map(perm => html`\n          <div class=\"row permission-row\">\n            <div class=\"col-md-6 p-3 fw-bolder fw-md-normal\">\n              <button class=\"btn btn-transparent fw-bolder fw-md-normal text-start\"\n                  title=\"${this.i18n[\"per.lis.perm.title\"]}\"\n                  data-perm=\"${perm}\"\n                  @click=${this._handleDescriptionClick}>\n                ${this.i18n[perm]}\n              </button>\n            </div>\n            ${this.roles.map(role => html`\n            <div class=\"col-md ${role.replace(\" \", \"_\")}-checkbox-cell text-start text-md-center p-3 permission-cell border-left-1\">\n              <label for=\"${role}:${perm}\" class=\"sr-only\">\n                <span>${this.i18n[\"gen.enable\"]} ${role}</span>\n              </label>\n              <input type=\"checkbox\"\n                  class=\"sakai-permission-checkbox\"\n                  aria-label=\"${this.i18n[\"gen.enable\"]} ${role}\"\n                  .checked=${this.on[role].includes(perm)}\n                  data-role=\"${role}\"\n                  data-perm=\"${perm}\"\n                  @change=${this._handlePermissionChange}\n                  id=\"${role}:${perm}\"/>\n              <div class=\"d-inline-block d-md-none ms-1\">\n                ${this.roleNameMappings[role]}\n              </div>\n            </div>\n            `)}\n          </div>\n          `)}\n        </div>\n\n        <div class=\"act\">\n          <input type=\"button\" class=\"active\" value=\"${this.i18n[\"gen.sav\"]}\" aria-label=\"${this.i18n[\"gen.sav\"]}\" @click=\"${this._savePermissions}\"/>\n          <input type=\"button\" value=\"${this.i18n[\"gen.can\"]}\" aria-label=\"${this.i18n[\"gen.can\"]}\" @click=\"${this._completePermissions}\"/>\n          <span id=\"${this.tool}-failure-message\" class=\"permissions-save-message\" style=\"display: none;\">${this.i18n[\"per.error.save\"]}</span>\n        </div>\n      `;\n    } else if (this.error) {\n      return html`<div class=\"sak-banner-error\">${this.i18n.alert_permission}</div>`;\n    }\n\n    return html`Waiting for permissions`;\n  }\n\n  _loadPermissions() {\n\n    const url = `/direct/permissions/${portal.siteId}/getPerms/${this.tool}.json?ref=${this.reference}`;\n    fetch(url, { cache: \"no-cache\", credentials: \"same-origin\" })\n      .then(res => {\n\n        if (res.status === 403) {\n          this.error = true;\n        } else {\n          this.error = false;\n          return res.json();\n        }\n      })\n      .then(data => {\n\n        this.on = data.on;\n        this.available = data.available;\n        if (!this.disableGroups) {\n          this.groups = data.groups;\n        }\n        this.roles = Object.keys(this.on);\n        this.roleNameMappings = data.roleNameMappings;\n        this.requestUpdate();\n      })\n      .catch(error => console.error(`Failed to load permissions for tool ${this.tool} from ${url}`, error));\n  }\n\n  _savePermissions() {\n\n    document.body.style.cursor = \"wait\";\n\n    const boxes = this.querySelectorAll(\"#permissions-container input[type=\\\"checkbox\\\"]\");\n    const params = `ref=${this.reference}&${ Array.from(boxes).reduce((acc, b) => {\n\n      if (b.checked) {\n        return `${acc }${encodeURIComponent(b.id)}=true&`;\n      }\n      return `${acc }${encodeURIComponent(b.id)}=false&`;\n\n    }, \"\")}`;\n\n    fetch(`/direct/permissions/${portal.siteId}/setPerms`, { method: \"POST\", credentials: \"same-origin\", body: new URLSearchParams(params), timeout: 30000 })\n      .then(res => {\n\n        if (res.ok) {\n          this._completePermissions();\n        } else {\n          throw new Error(\"Network response was not ok.\");\n        }\n      })\n      .catch(error => {\n\n        document.querySelector(`#${this.tool.replace(\".\", \"\\\\.\")}-failure-message`).style.display = \"inline-block\";\n        console.error(`Failed to save permissions for tool ${this.tool}`, error);\n      })\n      .finally(() => document.body.style.cursor = \"default\");\n  }\n\n  _resetPermissions() {\n\n    this.updateComplete.then(() => {\n\n      const inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n      inputs.forEach(elem => {\n\n        const role = elem.getAttribute(\"data-role\");\n        const perm = elem.getAttribute(\"data-perm\");\n        if (role && perm) {\n          const elemChanged = (elem.checked != this.on[role].includes(perm));\n          elem.checked = this.on[role].includes(perm);\n          elemChanged && elem.dispatchEvent(new Event(\"change\"));\n        }\n      });\n    });\n  }\n\n  _completePermissions() {\n\n    if (this.fireEvent) {\n      this.dispatchEvent(new CustomEvent(\"permissions-complete\"));\n    } else if (this.onRefresh) {\n      window.location.href = this.onRefresh;\n    } else {\n      window.location.reload();\n    }\n  }\n\n  _groupSelected(e) {\n\n    this.reference = e.detail.value;\n    this._loadPermissions();\n  }\n}\n", "import { SakaiPermissions } from \"./src/SakaiPermissions.js\";\nexport { SakaiPermissions };\n\n!customElements.get(\"sakai-permissions\") && customElements.define(\"sakai-permissions\", SakaiPermissions);\n"],
  "mappings": "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",
  "names": ["SakaiPermissions", "SakaiElement", "i18n", "tool", "k", "getSiteId", "all", "checked", "type", "role", "cell", "anyChecked", "input", "el", "ke", "D", "perm", "url", "res", "data", "error", "boxes", "params", "acc", "b", "elem", "elemChanged", "SakaiPermissions"]
}
